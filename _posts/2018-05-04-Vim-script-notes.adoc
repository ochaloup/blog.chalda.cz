= Vim script notes
:hp-tags: plugin, scripting
:toc: macro
:release: 1.0
:published_at: 2018-05-04
:icons: font

image::articles/vim-script.png[]

I wanted to enhance my workflow of using Vim during log investigation and I've created
a https://github.com/ochaloup/vim-syntax-match[plugin which helps me with text highlighting].
But getting to the stage the plugin is usable forced me to learn basics of
the Vim scripting language. This post is summary of some findings, not at all
any descriptive article about Vim script itself.

== Starting with the Vim script

There are quite a bunch of the articles on the internet teaching about Vim script.
I found nice these two series in particular:

icon:bookmark[] http://www.ibm.com/developerworks/library/l-vim-script-1/ (+ next 4 parts) +
icon:bookmark[] http://learnvimscriptthehardway.stevelosh.com/

== How to play with script writing

Now you want to write your own script to help you in your day to day work.
How to run it to try? My steps are creating a new vim script source code file
where I put the code - normally a function - and then I use command `:source <file path>`
to load the code and `:call <function name>` to execute it and observe results.

Let's say you have this function saved in file `/tmp/test.function.vim`.

This function go over all opened buffers in your opened Vim window
and print their name with echo command. It does skip the buffer to be printed
as active if it's type `'help'`.

NOTE: notice use of the `!` at the end of the  `function` declaration. This says
  that function redefinition will override the existing function with the same name.
  If you do not add the `!` then the Vim will not load the function and only
  shouts at you that error happened.

```vim
function! ListBuffers()
  let buffers = filter(range(1, bufnr('$')), 'bufexists(v:val)')
  for buffer in buffers
    if getbufvar(buffer, "&filetype") == 'help'
      " there was help skipping
      continue
    endif
    " ec is short version for echo
    ec 'Having an opened buffer: ' . buffer
  endfor
endfunction
```

When you have the function prepared you can load the script file and execute the function.

```vim
" short version of :source is :so
:source /tmp/test.function.vim
:call ListBuffers()
" if you want to get printed the function return value from use echo instead
:echo ListBuffers()
```

This is fine. You can start to tune your function. But still you need to write
some commands or list the command history. What about mapping the commands
to a keyboard shortcuts?

```vim
:nmap ;s :source /tmp/test.function.vim<CR>
:nmap ;b :call ListBuffers()<CR>
:nmap <silent> ;= :call ListBuffers()<CR>
```

* `<CR>` means `literal carriage return` which is needed when function should be executed
  (it replaces hitting ``<enter>` when you write it at the Vim command line manually)
* `<silent>` causes that _nmap_ mapping not to echo any command it's executing.

NOTE: If there is a better practice to work with Vim script let me know.
